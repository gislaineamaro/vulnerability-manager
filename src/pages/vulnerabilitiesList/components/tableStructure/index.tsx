import React, { useEffect, useState } from 'react'

import { Table, TableContainer } from '@chakra-ui/react'
import THead from '../../../../components/table/tHead'
import TBody from '../../../../components/table/tBody'
import axios from 'axios'

interface IVulnData {
  id: number
  title: string
  severity: string
  cvss: string
  publication_date: string
  asset_count: number
}

const TableStructure = () => {
  const [data, setData] = useState<IVulnData[]>([])

  useEffect(() => {
    let acessToken = localStorage.getItem('token')
    axios
      .get(`${process.env.REACT_APP_API_URL}/api/vulnerabilities/`, {
        headers: {
          Authorization: 'Token ' + acessToken
        }
      })
      .then(response => {
        setData(response.data.results)
      })
      .catch(e => {
        console.log('Erro ao requisitar listagem de vulnerabilidades.')
      })
  }, [])

  return (
    <>
      <TableContainer className="tableContent">
        <Table size="sm">
          <THead
            labelColumn={[
              'Titulo',
              'Severidade',
              'CVSS',
              'Data de PublicaÃ§Ã£o',
              'Quantidade de Hosts afetados'
            ]}
          />
          {data.map((data, key) => {
            return (
              <TBody
                key={key}
                labelRow={[
                  `${data.title.substr(0, 50)}${
                    data.title.length > 50 ? '...' : ''
                  }`,
                  data.severity,
                  data.cvss,
                  data.publication_date,
                  data.asset_count?.toString()
                ]}
              />
            )
          })}
        </Table>
      </TableContainer>
    </>
  )
}
export default TableStructure
