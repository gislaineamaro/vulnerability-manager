import React, { useEffect, useState } from 'react'
import axios from 'axios'

import LayoutBase from '../../components/layout-base'
import { Flex } from '@chakra-ui/react'
import { ICardRisk } from './types'
import Card from '../../components/card'
import './style.scss'

const Dashboard = () => {
  const [listRisk, setListRisk] = useState<ICardRisk>()

  useEffect(() => {
    handleSubmit()
  }, [])

  const handleSubmit = () => {
    let acessToken = localStorage.getItem('token')

    axios
      .get('http://201.49.62.134:8080/api/dashboard/cards/risk', {
        headers: {
          Authorization: 'Token ' + acessToken
        }
      })
      .then(Response => {
        setListRisk(Response.data)
      })
      .catch(e => {
        console.log('error')
      })
  }

  // const datas =

  return (
    <LayoutBase>
      <Flex className="contentDashboard">
        <Flex className="CardsBox">
          <Card
            data={{
              labels: [],
              datasets: [
                {
                  data: [listRisk?.risk_avg || 0, 100],
                  backgroundColor: ['#ff6385a2', '#36a3ebab']
                }
              ]
            }}
            value={listRisk?.risk_avg}
            label="Risco de Vulnerabilidade"
          />
        </Flex>
      </Flex>
    </LayoutBase>
  )
}

export default Dashboard
