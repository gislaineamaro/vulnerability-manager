import React, { useEffect, useState } from 'react'

import { Table, TableContainer } from '@chakra-ui/react'
import THead from '../../../../components/table/tHead'
import TBody from '../../../../components/table/tBody'
import axios from 'axios'

interface IAssetData {
  id: number
  created: string
  modified: string
  hostname: string
  ip_address: string
  risk: string
  vuln_count: number
}

const TableStructure = () => {
  const [data, setData] = useState<IAssetData[]>([])

  useEffect(() => {
    let acessToken = localStorage.getItem('token')
    axios
      .get(`${process.env.REACT_APP_API_URL}/api/assets/`, {
        headers: {
          Authorization: 'Token ' + acessToken
        }
      })
      .then(response => {
        setData(response.data.results)
      })
      .catch(e => {
        console.log('Erro ao requisitar listagem de hosts.')
      })
  }, [])

  return (
    <>
      <TableContainer className="tableContent">
        <Table size="sm">
          <THead
            labelColumn={[
              'Hostname',
              'IP',
              'Risco',
              'Quantidade de vulnerabilidades'
            ]}
          />
          {data.map((data, key) => {
            return (
              <TBody
                key={key}
                labelRow={[
                  data.hostname,
                  data.ip_address,
                  data.risk,
                  data.vuln_count.toString()
                ]}
              />
            )
          })}
        </Table>
      </TableContainer>
    </>
  )
}
export default TableStructure
